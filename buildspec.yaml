version: 0.2

phases:
  install:
    commands:
      - pip install --upgrade pip
      - sam --version
  build:
    commands:
      - cd Lists && sam build && cd ../
      - cd NotFound && sam build && cd ../
      - cd Products && sam build && cd ../
      - cd Contact && sam build && cd ../
  post_build:
    commands:
      - cd Lists && sam package --s3-bucket $LISTS_BUILD_OUTPUT_BUCKET --output-template-file lists-packaged.yaml && cd ../
      - cd NotFound && sam package --s3-bucket $NOTFOUND_BUILD_OUTPUT_BUCKET --output-template-file notfound-packaged.yaml && cd ../
      - cd Products && sam package --s3-bucket $PRODUCTS_BUILD_OUTPUT_BUCKET --output-template-file products-packaged.yaml && cd ../
      - cd Contact && sam package --s3-bucket $CONTACT_BUILD_OUTPUT_BUCKET --output-template-file contact-packaged.yaml && cd ../
      - echo "Copying email templates used by email cloudformation stack."
      - aws s3 cp cloudformation/ s3://services-email-templates/ --recursive --exclude "*" --include "email-template-*" && cd ../
artifacts:
  files:
    - Lists/lists-packaged.yaml
    - NotFound/notfound-packaged.yaml
    - Products/products-packaged.yaml
    - Contact/contact-packaged.yaml
  discard-paths: yes
